<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Container Order Builder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          screens: {
            'xs': '480px',
          }
        }
      }
    }
  </script>
  <style>
    @media print {
      .no-print { display: none !important; }
      body { background: white !important; }
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #1e293b; border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #64748b; }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
    @supports (-webkit-touch-callout: none) {
      .min-h-screen-ios { min-height: -webkit-fill-available; }
    }
  </style>
</head>
<body class="bg-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    const translations = {
      en: {
        appTitle: "Container Order Builder",
        appTitleShort: "Order Builder",
        products: "Products",
        container20ft: "20ft Container",
        containerShort: "Container",
        bottles: "bottles",
        bottlesShort: "btls",
        containerEmpty: "Container empty",
        bottlesToMinimum: "to minimum",
        optimalLoad: "Optimal load!",
        overBy: "Over by",
        markup: "MARKUP",
        quick: "Quick",
        preview: "Preview",
        cost: "Cost",
        resale: "resale",
        profitPerBottle: "per bottle",
        caseCost: "Case",
        btlPerCase: "Btl/Case",
        resalePerBtl: "Resale",
        profitPerCase: "Profit",
        addCases: "Add",
        adjustCases: "Adjust",
        case: "CASE",
        cases: "CASES",
        orderInfo: "Order Info",
        poNumber: "PO Number",
        vendor: "Vendor",
        vendorPlaceholder: "Vendor name",
        date: "Date",
        cart: "Cart",
        emptyCart: "Empty cart",
        orderNotes: "Order notes...",
        totalCases: "Cases",
        totalBottles: "Bottles",
        ourCost: "Cost",
        revenue: "Revenue",
        profit: "Profit",
        roi: "ROI",
        purchaseOrder: "PURCHASE ORDER",
        close: "Close",
        pricingTier: "Markup",
        internalCode: "Code",
        product: "Product",
        size: "Size",
        totalBtls: "Btls",
        revenueCol: "Rev",
        profitCol: "Profit",
        totalProfit: "TOTAL PROFIT",
        printSavePdf: "Print / PDF",
        generatePO: "Generate PO",
        all: "All",
        champagne: "Champagne",
        espumante: "Espumante",
        cognac: "Cognac",
        whisky: "Whisky",
        searchProducts: "Search...",
        clearAll: "Clear",
        viewCart: "View Cart",
        hideCart: "Hide Cart",
      },
      fr: {
        appTitle: "Constructeur de Commande",
        appTitleShort: "Commande",
        products: "Produits",
        container20ft: "Container 20 pieds",
        containerShort: "Container",
        bottles: "bouteilles",
        bottlesShort: "bout.",
        containerEmpty: "Container vide",
        bottlesToMinimum: "pour min.",
        optimalLoad: "Optimal!",
        overBy: "Excès",
        markup: "MARGE",
        quick: "Rapide",
        preview: "Aperçu",
        cost: "Coût",
        resale: "revente",
        profitPerBottle: "par bout.",
        caseCost: "Caisse",
        btlPerCase: "Btl/Cs",
        resalePerBtl: "Revente",
        profitPerCase: "Profit",
        addCases: "Ajouter",
        adjustCases: "Ajuster",
        case: "CAISSE",
        cases: "CAISSES",
        orderInfo: "Commande",
        poNumber: "N° Commande",
        vendor: "Fournisseur",
        vendorPlaceholder: "Nom",
        date: "Date",
        cart: "Panier",
        emptyCart: "Vide",
        orderNotes: "Notes...",
        totalCases: "Caisses",
        totalBottles: "Bouteilles",
        ourCost: "Coût",
        revenue: "Revenu",
        profit: "Profit",
        roi: "ROI",
        purchaseOrder: "BON DE COMMANDE",
        close: "Fermer",
        pricingTier: "Marge",
        internalCode: "Code",
        product: "Produit",
        size: "Taille",
        totalBtls: "Btls",
        revenueCol: "Rev",
        profitCol: "Profit",
        totalProfit: "PROFIT TOTAL",
        printSavePdf: "Imprimer",
        generatePO: "Générer BC",
        all: "Tous",
        champagne: "Champ.",
        espumante: "Espum.",
        cognac: "Cognac",
        whisky: "Whisky",
        searchProducts: "Rechercher...",
        clearAll: "Effacer",
        viewCart: "Voir Panier",
        hideCart: "Masquer",
      },
      es: {
        appTitle: "Constructor de Pedidos",
        appTitleShort: "Pedidos",
        products: "Productos",
        container20ft: "Contenedor 20 pies",
        containerShort: "Contenedor",
        bottles: "botellas",
        bottlesShort: "bot.",
        containerEmpty: "Vacío",
        bottlesToMinimum: "para mín.",
        optimalLoad: "¡Óptimo!",
        overBy: "Exceso",
        markup: "MARGEN",
        quick: "Rápido",
        preview: "Vista",
        cost: "Costo",
        resale: "reventa",
        profitPerBottle: "por bot.",
        caseCost: "Caja",
        btlPerCase: "Btl/Cj",
        resalePerBtl: "Reventa",
        profitPerCase: "Gan.",
        addCases: "Agregar",
        adjustCases: "Ajustar",
        case: "CAJA",
        cases: "CAJAS",
        orderInfo: "Pedido",
        poNumber: "N° Orden",
        vendor: "Proveedor",
        vendorPlaceholder: "Nombre",
        date: "Fecha",
        cart: "Carrito",
        emptyCart: "Vacío",
        orderNotes: "Notas...",
        totalCases: "Cajas",
        totalBottles: "Botellas",
        ourCost: "Costo",
        revenue: "Ingreso",
        profit: "Ganancia",
        roi: "ROI",
        purchaseOrder: "ORDEN DE COMPRA",
        close: "Cerrar",
        pricingTier: "Margen",
        internalCode: "Código",
        product: "Producto",
        size: "Tamaño",
        totalBtls: "Btls",
        revenueCol: "Ing",
        profitCol: "Gan",
        totalProfit: "GANANCIA TOTAL",
        printSavePdf: "Imprimir",
        generatePO: "Generar OC",
        all: "Todos",
        champagne: "Champ.",
        espumante: "Espum.",
        cognac: "Cognac",
        whisky: "Whisky",
        searchProducts: "Buscar...",
        clearAll: "Borrar",
        viewCart: "Ver Carrito",
        hideCart: "Ocultar",
      }
    };

    const CONTAINER_MIN = 7000;
    const CONTAINER_MAX = 9000;
    const CONTAINER_ABSOLUTE_MAX = 10000;

    const productData = [
      { codigo: "^27050000", internalCode: "CH ARM BRIG BRUT GOLD 750", category: "CHAMPAGNE", name: "ARMAND DE BRIGNAC BRUT GOLD GIFT BOX", abv: "12.5", sizeMl: "750", bottlesPerCase: 6, caseCost: 2100, costPerBottle: 350 },
      { codigo: "^27050005", internalCode: "CH CHA DELICE 750", category: "ESPUMANTE", name: "CHANDON DELICE", abv: "11.5", sizeMl: "750", bottlesPerCase: 6, caseCost: 72, costPerBottle: 12 },
      { codigo: "^27050006", internalCode: "CH CHA EXTRA BRUT", category: "ESPUMANTE", name: "CHANDON EXTRA BRUT", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 72, costPerBottle: 12 },
      { codigo: "^27050029", internalCode: "CH CHA GARDEN 750", category: "ESPUMANTE", name: "CHANDON GARDEN SPRITZ", abv: "11.5", sizeMl: "750", bottlesPerCase: 6, caseCost: 72, costPerBottle: 12 },
      { codigo: "^27050017", internalCode: "CH DON PER 750", category: "CHAMPAGNE", name: "DON PERIGNON SIN ESTUCHE", abv: "12.5", sizeMl: "750", bottlesPerCase: 6, caseCost: 1140, costPerBottle: 190 },
      { codigo: "^27050018", internalCode: "CH EXPRES BRUT 750ML", category: "CHAMPAGNE", name: "EXPRESION BRUT PREMIUM SPARKLING", abv: "11", sizeMl: "750", bottlesPerCase: 6, caseCost: 20, costPerBottle: 3.33 },
      { codigo: "^27050021", internalCode: "CH MOE ICE ROS 750", category: "CHAMPAGNE", name: "MOET CHANDON ICE ROSE IMPERIAL", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 330, costPerBottle: 55 },
      { codigo: "^27050022", internalCode: "CH MOE IMP 750", category: "CHAMPAGNE", name: "MOET CHANDON IMPERIAL BRUT", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 250, costPerBottle: 41.67 },
      { codigo: "^27050032", internalCode: "CH MOE IMP BRUT 750", category: "CHAMPAGNE", name: "MOET CHANDON IMPERIAL BRUT GIFT BOX", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 260, costPerBottle: 43.33 },
      { codigo: "^27050023", internalCode: "CH MOE IMP ICE 750", category: "CHAMPAGNE", name: "MOET CHANDON IMPERIAL ICE", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 280, costPerBottle: 46.67 },
      { codigo: "^27050024", internalCode: "CH MOE IMP NEC 750", category: "CHAMPAGNE", name: "MOET CHANDON NECTAR IMPERIAL", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 240, costPerBottle: 40 },
      { codigo: "^27050033", internalCode: "CH MOE ROSE 750", category: "CHAMPAGNE", name: "MOET CHANDON ROSE", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 280, costPerBottle: 46.67 },
      { codigo: "^27050026", internalCode: "CH VEU RICH 750", category: "CHAMPAGNE", name: "VEUVE CLICQUOT RICH", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 300, costPerBottle: 50 },
      { codigo: "^27050044", internalCode: "CH VEU RICH R 750", category: "CHAMPAGNE", name: "VEUVE CLICQUOT RICH ROSE", abv: "12", sizeMl: "750", bottlesPerCase: 6, caseCost: 390, costPerBottle: 65 },
      { codigo: "^27050027", internalCode: "CH VEU ROS 750", category: "CHAMPAGNE", name: "VEUVE CLICQUOT ROSE", abv: "12.5", sizeMl: "750", bottlesPerCase: 6, caseCost: 330, costPerBottle: 55 },
      { codigo: "^27060008", internalCode: "COG HEN VERY 700", category: "COGNAC", name: "HENNESSY VERY SPECIAL GIFTBOX", abv: "40", sizeMl: "700", bottlesPerCase: 12, caseCost: 310, costPerBottle: 25.83 },
      { codigo: "^27060011", internalCode: "COG HEN VSOP 1000", category: "COGNAC", name: "HENNESSY PRIVILEGE VSOP GIFTBOX 1L", abv: "40", sizeMl: "1000", bottlesPerCase: 12, caseCost: 720, costPerBottle: 60 },
      { codigo: "^27060000", internalCode: "COG HEN VSOP 700", category: "COGNAC", name: "HENNESSY PRIVILEGE VSOP GIFTBOX", abv: "40", sizeMl: "700", bottlesPerCase: 12, caseCost: 540, costPerBottle: 45 },
      { codigo: "^27060016", internalCode: "COG HEN XO 1000", category: "COGNAC", name: "HENNESSY XO GIFT BOX", abv: "40", sizeMl: "1000", bottlesPerCase: 6, caseCost: 1200, costPerBottle: 200 },
      { codigo: "^27060010", internalCode: "COG HEN XO 700", category: "COGNAC", name: "HENNESSY XO GIFTBOX", abv: "40", sizeMl: "700", bottlesPerCase: 12, caseCost: 1680, costPerBottle: 140 },
      { codigo: "^27180018", internalCode: "WK CHI 18Y 1000", category: "WHISKY", name: "CHIVAS REGAL 18 AÑOS", abv: "40", sizeMl: "1000", bottlesPerCase: 6, caseCost: 300, costPerBottle: 50 },
      { codigo: "^27180110", internalCode: "WK CHI 18Y 750", category: "WHISKY", name: "CHIVAS REGAL 18 AÑOS", abv: "40", sizeMl: "750", bottlesPerCase: 6, caseCost: 270, costPerBottle: 45 },
      { codigo: "^27180178", internalCode: "WK CHI 18Y COLLE 1000", category: "WHISKY", name: "CHIVAS REGAL 18 AÑOS ULTIMATE CASK JAPANESE", abv: "48", sizeMl: "1000", bottlesPerCase: 6, caseCost: 510, costPerBottle: 85 },
      { codigo: "^27180019", internalCode: "WK CHI 25Y 700", category: "WHISKY", name: "CHIVAS REGAL 25 AÑOS", abv: "40", sizeMl: "700", bottlesPerCase: 3, caseCost: 645, costPerBottle: 215 },
      { codigo: "^27180179", internalCode: "WK CHI ULTIS BLE 1000", category: "WHISKY", name: "CHIVAS REGAL ULTIS BLENDED SCOTCH", abv: "40", sizeMl: "1000", bottlesPerCase: 3, caseCost: 1074, costPerBottle: 358 },
      { codigo: "^27180022", internalCode: "WK CHI WINE CASK 18Y 1000", category: "WHISKY", name: "CHIVAS REGAL 18 AÑOS WINE CASK", abv: "48", sizeMl: "1000", bottlesPerCase: 6, caseCost: 594, costPerBottle: 99 },
      { codigo: "^27180043", internalCode: "WK GRA TRIP WOOD 1000", category: "WHISKY", name: "GRANTS TRIPLE WOOD FAMILY RESERVA", abv: "40", sizeMl: "1000", bottlesPerCase: 12, caseCost: 80, costPerBottle: 6.67 },
      { codigo: "^27180067", internalCode: "WK JOHW RED 1000", category: "WHISKY", name: "JOHNNIE WALKER RED", abv: "40", sizeMl: "1000", bottlesPerCase: 12, caseCost: 115, costPerBottle: 9.58 },
      { codigo: "^27180068", internalCode: "WK JOHW RED 375", category: "WHISKY", name: "JOHNNIE WALKER RED", abv: "40", sizeMl: "375", bottlesPerCase: 24, caseCost: 132, costPerBottle: 5.5 },
      { codigo: "^27180070", internalCode: "WK JOHW RED 750", category: "WHISKY", name: "JOHNNIE WALKER RED", abv: "40", sizeMl: "750", bottlesPerCase: 12, caseCost: 94, costPerBottle: 7.83 },
      { codigo: "^27180057", internalCode: "WK JOHW 12Y 1000", category: "WHISKY", name: "JOHNNIE WALKER BLACK 12 AÑOS", abv: "40", sizeMl: "1000", bottlesPerCase: 12, caseCost: 250, costPerBottle: 20.83 },
      { codigo: "^27180145", internalCode: "WK JOHW 12Y 1750", category: "WHISKY", name: "JOHNNIE WALKER BLACK 12 AÑOS", abv: "40", sizeMl: "1750", bottlesPerCase: 6, caseCost: 270, costPerBottle: 22.5 },
      { codigo: "^27180058", internalCode: "WK JOHW 12Y 375", category: "WHISKY", name: "JOHNNIE WALKER BLACK 12 AÑOS", abv: "40", sizeMl: "375", bottlesPerCase: 24, caseCost: 240, costPerBottle: 10 },
      { codigo: "^27180059", internalCode: "WK JOHW 12Y 750", category: "WHISKY", name: "JOHNNIE WALKER BLACK 12 AÑOS", abv: "40", sizeMl: "750", bottlesPerCase: 12, caseCost: 210, costPerBottle: 17.5 },
      { codigo: "^27180061", internalCode: "WK JOHW BLUE 1000", category: "WHISKY", name: "JOHNNIE WALKER BLUE LABEL BOX", abv: "43", sizeMl: "1000", bottlesPerCase: 6, caseCost: 1140, costPerBottle: 190 },
      { codigo: "^27180062", internalCode: "WK JOHW BLUE 750", category: "WHISKY", name: "JOHNNIE WALKER BLUE LABEL BOX", abv: "40", sizeMl: "750", bottlesPerCase: 6, caseCost: 820, costPerBottle: 136.67 },
    ];

    const presetMarkups = [15, 20, 50];

    const categoryColors = {
      CHAMPAGNE: { bg: 'bg-amber-900/30', border: 'border-amber-500/40', text: 'text-amber-300' },
      ESPUMANTE: { bg: 'bg-pink-900/30', border: 'border-pink-500/40', text: 'text-pink-300' },
      COGNAC: { bg: 'bg-orange-900/30', border: 'border-orange-500/40', text: 'text-orange-300' },
      WHISKY: { bg: 'bg-amber-800/30', border: 'border-amber-600/40', text: 'text-amber-200' },
    };

    const Icons = {
      Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>,
      Wine: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 22h8M12 18v4M12 18a5 5 0 0 0 5-5c0-4-5-9-5-9s-5 5-5 9a5 5 0 0 0 5 5Z"/></svg>,
      Package: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m7.5 4.27 9 5.15M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5M12 22V12"/></svg>,
      Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
      FileText: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>,
      ShoppingCart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
      Printer: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"/><rect width="12" height="8" x="6" y="14" rx="1"/></svg>,
      X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg>,
      Check: () => <svg className="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4 12 14.01l-3-3"/></svg>,
      Alert: () => <svg className="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4M12 17h.01"/></svg>,
      ChevronUp: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m18 15-6-6-6 6"/></svg>,
      ChevronDown: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>,
      Plus: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>,
      Minus: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M5 12h14"/></svg>,
    };

    function App() {
      const [language, setLanguage] = useState('en');
      const [search, setSearch] = useState('');
      const [category, setCategory] = useState('All');
      const [cart, setCart] = useState([]);
      const [showPO, setShowPO] = useState(false);
      const [markupPercent, setMarkupPercent] = useState(20);
      const [showMobileCart, setShowMobileCart] = useState(false);
      const [poInfo, setPoInfo] = useState({
        poNumber: `PO-${Date.now().toString().slice(-6)}`,
        vendor: '',
        date: new Date().toISOString().split('T')[0],
        notes: ''
      });

      const t = translations[language];

      const getCategoryLabel = (cat) => {
        const catMap = { 'All': t.all, 'CHAMPAGNE': t.champagne, 'ESPUMANTE': t.espumante, 'COGNAC': t.cognac, 'WHISKY': t.whisky };
        return catMap[cat] || cat;
      };

      const calculatePricing = (product) => {
        const resalePrice = product.costPerBottle * (1 + markupPercent / 100);
        const profitPerBottle = resalePrice - product.costPerBottle;
        const revenuePerCase = resalePrice * product.bottlesPerCase;
        const profitPerCase = profitPerBottle * product.bottlesPerCase;
        return { resalePrice, profitPerBottle, revenuePerCase, profitPerCase };
      };

      const filteredProducts = useMemo(() => {
        return productData.filter(p => {
          const searchLower = search.toLowerCase();
          const matchesSearch = p.name.toLowerCase().includes(searchLower) || p.internalCode.toLowerCase().includes(searchLower);
          const matchesCategory = category === 'All' || p.category === category;
          return matchesSearch && matchesCategory;
        });
      }, [search, category]);

      const addToCart = (product, qty = 1) => {
        const existing = cart.find(item => item.codigo === product.codigo);
        if (existing) {
          setCart(cart.map(item => item.codigo === product.codigo ? { ...item, qty: item.qty + qty } : item));
        } else {
          setCart([...cart, { ...product, qty }]);
        }
      };

      const updateQty = (codigo, delta) => {
        setCart(cart.map(item => {
          if (item.codigo === codigo) return { ...item, qty: Math.max(0, item.qty + delta) };
          return item;
        }).filter(item => item.qty > 0));
      };

      const setQty = (codigo, value) => {
        const newQty = Math.max(0, parseInt(value) || 0);
        if (newQty === 0) {
          setCart(cart.filter(item => item.codigo !== codigo));
        } else {
          setCart(cart.map(item => item.codigo === codigo ? { ...item, qty: newQty } : item));
        }
      };

      const removeFromCart = (codigo) => setCart(cart.filter(item => item.codigo !== codigo));

      const totals = useMemo(() => {
        const totalCases = cart.reduce((sum, item) => sum + item.qty, 0);
        const totalBottles = cart.reduce((sum, item) => sum + (item.qty * item.bottlesPerCase), 0);
        const totalCost = cart.reduce((sum, item) => sum + (item.qty * item.caseCost), 0);
        const totalRevenue = cart.reduce((sum, item) => sum + (item.qty * calculatePricing(item).revenuePerCase), 0);
        const totalProfit = cart.reduce((sum, item) => sum + (item.qty * calculatePricing(item).profitPerCase), 0);
        return { totalCases, totalBottles, totalCost, totalRevenue, totalProfit };
      }, [cart, markupPercent]);

      const containerStatus = useMemo(() => {
        const bottles = totals.totalBottles;
        if (bottles === 0) return { status: 'empty', message: t.containerEmpty };
        if (bottles < CONTAINER_MIN) return { status: 'under', message: `${(CONTAINER_MIN - bottles).toLocaleString()} ${t.bottlesToMinimum}` };
        if (bottles <= CONTAINER_MAX) return { status: 'optimal', message: t.optimalLoad };
        return { status: 'over', message: `${t.overBy} ${(bottles - CONTAINER_MAX).toLocaleString()}!` };
      }, [totals.totalBottles, t]);

      const formatCurrency = (val) => `$${val.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
      const formatCurrencyFull = (val) => `$${val.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      const formatSize = (ml) => { if (!ml) return ''; const num = parseInt(ml); return num >= 1000 ? `${num/1000}L` : `${num}ml`; };

      const handleMarkupChange = (value) => {
        const num = parseFloat(value);
        if (!isNaN(num) && num >= 0) setMarkupPercent(num);
        else if (value === '') setMarkupPercent(0);
      };

      // Language Selector
      const LanguageSelector = () => (
        <div className="flex bg-slate-800/80 rounded-lg border border-slate-600 overflow-hidden">
          {['en', 'fr', 'es'].map((lang, idx) => (
            <button key={lang} onClick={() => setLanguage(lang)} className={`px-3 py-1.5 text-xs sm:text-sm font-semibold transition-all ${language === lang ? 'bg-amber-500 text-slate-900' : 'text-slate-400 hover:text-white'} ${idx > 0 ? 'border-l border-slate-600' : ''}`}>
              {lang.toUpperCase()}
            </button>
          ))}
        </div>
      );

      // Container Gauge - Responsive
      const ContainerGauge = () => {
        const bottles = totals.totalBottles;
        const minPercent = (CONTAINER_MIN / CONTAINER_ABSOLUTE_MAX) * 100;
        const maxPercent = (CONTAINER_MAX / CONTAINER_ABSOLUTE_MAX) * 100;
        const currentPercent = Math.min((bottles / CONTAINER_ABSOLUTE_MAX) * 100, 100);
        
        return (
          <div className="bg-slate-800 rounded-xl p-3 sm:p-4 border border-slate-700">
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <span className="text-blue-400"><Icons.Package /></span>
                <span className="font-bold text-sm sm:text-lg hidden xs:inline">{t.container20ft}</span>
                <span className="font-bold text-sm xs:hidden">{t.containerShort}</span>
              </div>
              <div className="text-right">
                <span className={`text-xl sm:text-2xl font-bold ${containerStatus.status === 'optimal' ? 'text-green-400' : containerStatus.status === 'over' ? 'text-red-400' : containerStatus.status === 'under' ? 'text-blue-400' : 'text-slate-400'}`}>{bottles.toLocaleString()}</span>
                <span className="text-slate-400 text-xs sm:text-sm"> / {CONTAINER_MIN.toLocaleString()}-{CONTAINER_MAX.toLocaleString()}</span>
              </div>
            </div>
            <div className="relative h-6 sm:h-8 bg-slate-700 rounded-lg overflow-hidden">
              <div className="absolute h-full bg-green-900/30 border-l-2 border-r-2 border-green-500/50" style={{ left: `${minPercent}%`, width: `${maxPercent - minPercent}%` }} />
              <div className={`h-full transition-all duration-300 ${containerStatus.status === 'optimal' ? 'bg-gradient-to-r from-green-600 to-green-500' : containerStatus.status === 'over' ? 'bg-gradient-to-r from-red-600 to-red-500' : containerStatus.status === 'under' ? 'bg-gradient-to-r from-blue-600 to-blue-500' : 'bg-slate-600'}`} style={{ width: `${currentPercent}%` }} />
              <div className="absolute inset-0 flex items-center text-xs font-bold">
                <div className="absolute text-green-400" style={{ left: `${minPercent}%`, transform: 'translateX(-50%)' }}><div className="bg-slate-800 px-1 rounded">7K</div></div>
                <div className="absolute text-green-400" style={{ left: `${maxPercent}%`, transform: 'translateX(-50%)' }}><div className="bg-slate-800 px-1 rounded">9K</div></div>
              </div>
            </div>
            <div className={`mt-1 text-center font-semibold text-sm ${containerStatus.status === 'optimal' ? 'text-green-400' : containerStatus.status === 'over' ? 'text-red-400' : containerStatus.status === 'under' ? 'text-blue-400' : 'text-slate-500'}`}>
              {containerStatus.status === 'optimal' && <Icons.Check />}
              {containerStatus.status === 'over' && <Icons.Alert />}
              {' '}{containerStatus.message}
            </div>
          </div>
        );
      };

      // Mobile Product Card
      const MobileProductCard = ({ product }) => {
        const inCart = cart.find(item => item.codigo === product.codigo);
        const colors = categoryColors[product.category];
        const pricing = calculatePricing(product);
        const currentQty = inCart?.qty || 0;

        return (
          <div className={`p-3 rounded-xl border transition ${inCart ? 'bg-amber-900/30 border-amber-500/60' : `${colors.bg} ${colors.border}`}`}>
            <div className="flex justify-between items-start mb-2">
              <div className="flex-1 min-w-0 pr-2">
                <div className="flex items-center gap-1 mb-1 flex-wrap">
                  <span className={`text-xs px-1.5 py-0.5 rounded ${colors.bg} ${colors.text} border ${colors.border}`}>{product.category}</span>
                  <span className="text-xs text-slate-500">{formatSize(product.sizeMl)}</span>
                </div>
                <h3 className="font-semibold text-sm leading-tight line-clamp-2">{product.name}</h3>
              </div>
              <div className="text-right flex-shrink-0">
                <p className="text-amber-400 font-bold">${product.caseCost}</p>
                <p className="text-xs text-slate-400">{product.bottlesPerCase} {t.bottlesShort}</p>
              </div>
            </div>
            
            <div className="flex items-center justify-between bg-slate-900/50 rounded-lg p-2">
              <div className="text-xs">
                <span className="text-green-400">+${pricing.profitPerCase.toFixed(0)}/{t.case.toLowerCase()}</span>
              </div>
              <div className="flex items-center gap-2">
                {currentQty > 0 && (
                  <button onClick={() => updateQty(product.codigo, -1)} className="w-10 h-10 rounded-lg bg-red-600 active:bg-red-500 text-white flex items-center justify-center">
                    <Icons.Minus />
                  </button>
                )}
                {currentQty > 0 ? (
                  <span className="w-12 text-center font-bold text-lg">{currentQty}</span>
                ) : null}
                <button onClick={() => addToCart(product, 1)} className="w-10 h-10 rounded-lg bg-green-600 active:bg-green-500 text-white flex items-center justify-center">
                  <Icons.Plus />
                </button>
                {currentQty === 0 && (
                  <button onClick={() => addToCart(product, 10)} className="w-10 h-10 rounded-lg bg-green-700 active:bg-green-600 text-white flex items-center justify-center text-sm font-bold">+10</button>
                )}
              </div>
            </div>
            {currentQty > 0 && (
              <div className="mt-2 text-center text-xs text-slate-400">
                {currentQty} × {product.bottlesPerCase} = <span className="text-white font-semibold">{(currentQty * product.bottlesPerCase).toLocaleString()} {t.bottlesShort}</span>
                <span className="text-green-400 ml-2">+{formatCurrency(currentQty * pricing.profitPerCase)}</span>
              </div>
            )}
          </div>
        );
      };

      // Desktop Product Card
      const DesktopProductCard = ({ product }) => {
        const inCart = cart.find(item => item.codigo === product.codigo);
        const colors = categoryColors[product.category];
        const pricing = calculatePricing(product);
        const currentQty = inCart?.qty || 0;

        return (
          <div className={`p-3 rounded-xl border transition ${inCart ? 'bg-amber-900/30 border-amber-500/60 ring-2 ring-amber-500/30' : `${colors.bg} ${colors.border}`}`}>
            <div className="flex gap-3 items-center">
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1 flex-wrap">
                  <span className={`text-xs px-2 py-0.5 rounded-full ${colors.bg} ${colors.text} border ${colors.border}`}>{product.category}</span>
                  <span className="text-xs text-slate-500">{formatSize(product.sizeMl)}</span>
                  <span className="text-xs text-slate-500">{product.abv}%</span>
                  {inCart && <span className="text-xs px-2 py-0.5 rounded-full bg-amber-500 text-slate-900 font-bold">{inCart.qty} × {product.bottlesPerCase} = {(inCart.qty * product.bottlesPerCase).toLocaleString()}</span>}
                </div>
                <h3 className="font-semibold leading-tight truncate">{product.name}</h3>
                <p className="text-xs text-slate-400 truncate">{product.internalCode}</p>
              </div>
              <div className="flex gap-1.5 text-center text-xs flex-shrink-0">
                <div className="w-16 px-1 py-1.5 bg-slate-900/50 rounded-lg"><p className="text-slate-500">{t.caseCost}</p><p className="font-bold text-amber-400">${product.caseCost}</p></div>
                <div className="w-14 px-1 py-1.5 bg-slate-900/50 rounded-lg"><p className="text-slate-500">{t.btlPerCase}</p><p className="font-bold">{product.bottlesPerCase}</p></div>
                <div className="w-16 px-1 py-1.5 bg-green-900/30 rounded-lg border border-green-500/30"><p className="text-green-400">{t.resalePerBtl}</p><p className="font-bold text-green-400">${pricing.resalePrice.toFixed(2)}</p></div>
                <div className="w-16 px-1 py-1.5 bg-green-900/30 rounded-lg border border-green-500/30"><p className="text-green-400">{t.profitPerCase}</p><p className="font-bold text-green-400">${pricing.profitPerCase.toFixed(0)}</p></div>
              </div>
              <div className="flex flex-col gap-1 w-48">
                <div className="flex items-center gap-1">
                  {currentQty > 0 ? (
                    <>
                      <button onClick={() => updateQty(product.codigo, -10)} className="w-9 h-9 rounded-lg bg-red-700 hover:bg-red-600 text-white font-bold text-sm">-10</button>
                      <button onClick={() => updateQty(product.codigo, -1)} className="w-8 h-9 rounded-lg bg-red-600 hover:bg-red-500 text-white font-bold">-1</button>
                      <input type="number" value={currentQty} onChange={(e) => setQty(product.codigo, e.target.value)} className="w-12 h-9 text-center bg-slate-800 border-2 border-amber-500 rounded-lg font-bold focus:outline-none" min="0" />
                      <button onClick={() => updateQty(product.codigo, 1)} className="w-8 h-9 rounded-lg bg-green-600 hover:bg-green-500 text-white font-bold">+1</button>
                      <button onClick={() => updateQty(product.codigo, 10)} className="w-9 h-9 rounded-lg bg-green-700 hover:bg-green-600 text-white font-bold text-sm">+10</button>
                    </>
                  ) : (
                    <>
                      <button onClick={() => addToCart(product, 1)} className="flex-1 h-10 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg">+1</button>
                      <button onClick={() => addToCart(product, 10)} className="flex-1 h-10 bg-green-700 hover:bg-green-600 text-white font-bold rounded-lg">+10</button>
                    </>
                  )}
                </div>
                {currentQty > 0 && (
                  <div className="text-center text-xs">
                    <span className="text-slate-400">= {(currentQty * product.bottlesPerCase).toLocaleString()} btls</span>
                    <span className="text-green-400 ml-1">+{formatCurrency(currentQty * pricing.profitPerCase)}</span>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      // Mobile Cart Panel
      const MobileCartPanel = () => (
        <div className={`fixed inset-x-0 bottom-0 z-50 transition-transform duration-300 ${showMobileCart ? 'translate-y-0' : 'translate-y-full'}`}>
          <div className="bg-slate-800 border-t border-slate-700 rounded-t-2xl max-h-[70vh] overflow-hidden flex flex-col safe-bottom">
            <div className="p-3 border-b border-slate-700 flex justify-between items-center flex-shrink-0">
              <h2 className="font-bold flex items-center gap-2"><Icons.ShoppingCart /> {t.cart} ({cart.length})</h2>
              <button onClick={() => setShowMobileCart(false)} className="p-2 text-slate-400"><Icons.X /></button>
            </div>
            <div className="flex-1 overflow-y-auto p-3 space-y-2">
              {cart.length === 0 ? (
                <p className="text-center text-slate-500 py-8">{t.emptyCart}</p>
              ) : cart.map(item => {
                const pricing = calculatePricing(item);
                return (
                  <div key={item.codigo} className="flex items-center gap-2 bg-slate-900/50 rounded-lg p-2">
                    <div className="flex-1 min-w-0">
                      <p className="font-medium text-sm truncate">{item.name}</p>
                      <p className="text-xs text-slate-400">{item.qty} × {item.bottlesPerCase} = {(item.qty * item.bottlesPerCase).toLocaleString()}</p>
                    </div>
                    <p className="text-green-400 text-sm font-semibold">+{formatCurrency(item.qty * pricing.profitPerCase)}</p>
                    <button onClick={() => removeFromCart(item.codigo)} className="p-2 text-red-400"><Icons.Trash /></button>
                  </div>
                );
              })}
            </div>
            <div className="p-3 border-t border-slate-700 bg-slate-800 flex-shrink-0">
              <div className="grid grid-cols-3 gap-2 mb-3 text-center text-sm">
                <div><p className="text-slate-400">{t.totalCases}</p><p className="font-bold text-lg">{totals.totalCases}</p></div>
                <div><p className="text-slate-400">{t.totalBottles}</p><p className={`font-bold text-lg ${containerStatus.status === 'optimal' ? 'text-green-400' : containerStatus.status === 'over' ? 'text-red-400' : ''}`}>{totals.totalBottles.toLocaleString()}</p></div>
                <div><p className="text-green-400">{t.profit}</p><p className="font-bold text-lg text-green-400">{formatCurrency(totals.totalProfit)}</p></div>
              </div>
              <button onClick={() => { setShowMobileCart(false); setShowPO(true); }} disabled={cart.length === 0} className={`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${cart.length === 0 ? 'bg-slate-700 text-slate-500' : 'bg-green-500 text-white'}`}>
                <Icons.FileText /> {t.generatePO}
              </button>
            </div>
          </div>
        </div>
      );

      // Purchase Order View
      if (showPO) {
        return (
          <div className="min-h-screen bg-gray-100 p-2 sm:p-4 print:p-0 print:bg-white">
            <div className="max-w-5xl mx-auto bg-white rounded-lg shadow-lg p-4 sm:p-8 print:shadow-none">
              <div className="flex justify-between items-start mb-4 sm:mb-6 border-b pb-4">
                <div>
                  <h1 className="text-xl sm:text-3xl font-bold text-gray-800">{t.purchaseOrder}</h1>
                  <p className="text-sm sm:text-lg text-gray-600 font-mono">{poInfo.poNumber}</p>
                </div>
                <button onClick={() => setShowPO(false)} className="no-print p-2 sm:px-4 sm:py-2 bg-gray-200 rounded-lg hover:bg-gray-300 flex items-center gap-1 sm:gap-2">
                  <Icons.X /> <span className="hidden sm:inline">{t.close}</span>
                </button>
              </div>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6 text-sm">
                <div><p className="text-gray-500">{t.date}</p><p className="font-medium">{poInfo.date}</p></div>
                <div><p className="text-gray-500">{t.vendor}</p><p className="font-medium">{poInfo.vendor || '—'}</p></div>
                <div><p className="text-gray-500">{t.pricingTier}</p><p className="font-medium text-green-600">{markupPercent}%</p></div>
                <div><p className="text-gray-500">{t.totalBottles}</p><p className="font-medium">{totals.totalBottles.toLocaleString()}</p></div>
              </div>
              
              {/* Mobile Table */}
              <div className="sm:hidden space-y-2 mb-4">
                {cart.map(item => {
                  const pricing = calculatePricing(item);
                  return (
                    <div key={item.codigo} className="bg-gray-50 rounded-lg p-3">
                      <p className="font-medium text-sm">{item.name}</p>
                      <div className="grid grid-cols-3 gap-2 mt-2 text-xs">
                        <div><span className="text-gray-500">{t.cases}:</span> <span className="font-semibold">{item.qty}</span></div>
                        <div><span className="text-gray-500">{t.totalBtls}:</span> <span className="font-semibold text-blue-600">{item.qty * item.bottlesPerCase}</span></div>
                        <div><span className="text-gray-500">{t.profitCol}:</span> <span className="font-semibold text-green-600">{formatCurrency(item.qty * pricing.profitPerCase)}</span></div>
                      </div>
                    </div>
                  );
                })}
              </div>

              {/* Desktop Table */}
              <table className="hidden sm:table w-full mb-6 text-sm">
                <thead><tr className="border-b-2 border-gray-300 bg-gray-50"><th className="text-left py-2 px-2">{t.internalCode}</th><th className="text-left py-2 px-2">{t.product}</th><th className="text-center py-2 px-2">{t.size}</th><th className="text-center py-2 px-2">{t.cases}</th><th className="text-center py-2 px-2">{t.btlPerCase}</th><th className="text-center py-2 px-2">{t.totalBtls}</th><th className="text-right py-2 px-2">{t.ourCost}</th><th className="text-right py-2 px-2">{t.resalePerBtl}</th><th className="text-right py-2 px-2">{t.revenueCol}</th><th className="text-right py-2 px-2">{t.profitCol}</th></tr></thead>
                <tbody>
                  {cart.map((item, idx) => {
                    const pricing = calculatePricing(item);
                    return (
                      <tr key={item.codigo} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                        <td className="py-2 px-2 font-mono text-xs">{item.internalCode}</td>
                        <td className="py-2 px-2"><div className="font-medium">{item.name}</div></td>
                        <td className="py-2 px-2 text-center">{formatSize(item.sizeMl)}</td>
                        <td className="py-2 px-2 text-center font-semibold">{item.qty}</td>
                        <td className="py-2 px-2 text-center">{item.bottlesPerCase}</td>
                        <td className="py-2 px-2 text-center font-semibold text-blue-600">{item.qty * item.bottlesPerCase}</td>
                        <td className="py-2 px-2 text-right">{formatCurrencyFull(item.qty * item.caseCost)}</td>
                        <td className="py-2 px-2 text-right">{formatCurrencyFull(pricing.resalePrice)}</td>
                        <td className="py-2 px-2 text-right">{formatCurrencyFull(item.qty * pricing.revenuePerCase)}</td>
                        <td className="py-2 px-2 text-right font-semibold text-green-600">{formatCurrencyFull(item.qty * pricing.profitPerCase)}</td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
              
              <div className="flex justify-end">
                <div className="w-full sm:w-80 space-y-2 text-sm">
                  <div className="flex justify-between py-1"><span className="text-gray-600">{t.totalCases}:</span><span className="font-medium">{totals.totalCases}</span></div>
                  <div className="flex justify-between py-1"><span className="text-gray-600">{t.totalBottles}:</span><span className="font-medium">{totals.totalBottles.toLocaleString()}</span></div>
                  <div className="flex justify-between py-2 border-t"><span className="text-gray-600">{t.ourCost}:</span><span className="font-semibold">{formatCurrencyFull(totals.totalCost)}</span></div>
                  <div className="flex justify-between py-2 border-t"><span className="text-gray-600">{t.revenue} ({markupPercent}%):</span><span className="font-semibold">{formatCurrencyFull(totals.totalRevenue)}</span></div>
                  <div className="flex justify-between py-3 border-t-2 border-gray-800"><span className="text-lg font-bold">{t.totalProfit}:</span><span className="text-lg font-bold text-green-600">{formatCurrencyFull(totals.totalProfit)}</span></div>
                </div>
              </div>
              <div className="mt-4 sm:mt-6 pt-4 border-t no-print">
                <button onClick={() => window.print()} className="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                  <Icons.Printer /> {t.printSavePdf}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Main View
      return (
        <div className="min-h-screen min-h-screen-ios bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white pb-20 lg:pb-4">
          <div className="max-w-7xl mx-auto p-2 sm:p-4">
            {/* Header */}
            <div className="flex items-center justify-between mb-2 sm:mb-3 gap-2">
              <div className="flex items-center gap-2 sm:gap-4 min-w-0">
                <div className="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center text-slate-900 flex-shrink-0"><Icons.Wine /></div>
                <div className="min-w-0">
                  <h1 className="text-lg sm:text-2xl font-bold truncate">{window.innerWidth < 480 ? t.appTitleShort : t.appTitle}</h1>
                  <p className="text-slate-400 text-xs sm:text-sm">{productData.length} {t.products}</p>
                </div>
              </div>
              <div className="flex items-center gap-2 flex-shrink-0">
                <LanguageSelector />
                {/* Desktop Stats */}
                <div className="hidden md:flex items-center gap-2">
                  <div className="text-center px-3 py-2 bg-slate-800 rounded-lg"><p className="text-xs text-slate-400">{t.totalCases}</p><p className="text-xl font-bold text-amber-400">{totals.totalCases}</p></div>
                  <div className="text-center px-3 py-2 bg-slate-800 rounded-lg"><p className="text-xs text-slate-400">{t.cost}</p><p className="text-xl font-bold">{formatCurrency(totals.totalCost)}</p></div>
                  <div className="text-center px-3 py-2 bg-green-900/50 rounded-lg border border-green-500/30"><p className="text-xs text-green-400">{t.profit}</p><p className="text-xl font-bold text-green-400">{formatCurrency(totals.totalProfit)}</p></div>
                </div>
              </div>
            </div>

            <ContainerGauge />

            {/* Markup Selector */}
            <div className="my-2 sm:my-3 p-3 sm:p-4 bg-slate-800/50 rounded-xl border border-slate-700">
              <div className="flex items-center justify-between flex-wrap gap-2 sm:gap-4">
                <div className="flex items-center gap-2 sm:gap-4 flex-wrap">
                  <span className="text-sm text-slate-300 font-semibold">{t.markup}:</span>
                  <div className="flex items-center gap-1 sm:gap-2">
                    <input type="number" value={markupPercent} onChange={(e) => handleMarkupChange(e.target.value)} className="w-16 sm:w-20 h-10 sm:h-12 text-center bg-slate-900 border-2 border-green-500 rounded-xl font-bold text-xl sm:text-2xl text-green-400 focus:outline-none" min="0" max="999" step="0.1" />
                    <span className="text-xl sm:text-2xl font-bold text-green-400">%</span>
                  </div>
                  <div className="flex gap-1 sm:gap-2">
                    {presetMarkups.map(preset => (
                      <button key={preset} onClick={() => setMarkupPercent(preset)} className={`w-12 sm:w-14 py-2 rounded-lg font-bold text-sm transition ${markupPercent === preset ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-300'}`}>{preset}%</button>
                    ))}
                  </div>
                </div>
                {cart.length > 0 && <button onClick={() => setCart([])} className="text-sm text-red-400 px-2 py-1 rounded border border-red-500/30">{t.clearAll} ({cart.length})</button>}
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-2 sm:gap-4">
              {/* Products */}
              <div className="lg:col-span-2 space-y-2 sm:space-y-3">
                {/* Search & Filter */}
                <div className="flex gap-2">
                  <div className="flex-1 relative">
                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Icons.Search /></span>
                    <input type="text" placeholder={t.searchProducts} value={search} onChange={(e) => setSearch(e.target.value)} className="w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-xl focus:outline-none focus:border-amber-400" />
                  </div>
                </div>
                {/* Category Filter - Scrollable on mobile */}
                <div className="flex gap-1 overflow-x-auto pb-1 scrollbar-thin">
                  {['All', 'CHAMPAGNE', 'ESPUMANTE', 'COGNAC', 'WHISKY'].map(cat => (
                    <button key={cat} onClick={() => setCategory(cat)} className={`px-3 py-1.5 text-sm rounded-lg font-medium transition whitespace-nowrap flex-shrink-0 ${category === cat ? 'bg-amber-500 text-slate-900' : 'bg-slate-800 text-slate-400'}`}>{getCategoryLabel(cat)}</button>
                  ))}
                </div>
                
                {/* Product List */}
                <div className="space-y-2 max-h-[calc(100vh-380px)] sm:max-h-[calc(100vh-400px)] overflow-y-auto pr-1 scrollbar-thin">
                  {/* Mobile Cards */}
                  <div className="lg:hidden space-y-2">
                    {filteredProducts.map(product => <MobileProductCard key={product.codigo} product={product} />)}
                  </div>
                  {/* Desktop Cards */}
                  <div className="hidden lg:block space-y-2">
                    {filteredProducts.map(product => <DesktopProductCard key={product.codigo} product={product} />)}
                  </div>
                </div>
              </div>

              {/* Desktop Cart Sidebar */}
              <div className="hidden lg:block space-y-3">
                <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                  <h2 className="font-semibold mb-3 flex items-center gap-2"><span className="text-amber-400"><Icons.FileText /></span> {t.orderInfo}</h2>
                  <div className="space-y-2">
                    <div><label className="text-xs text-slate-400">{t.poNumber}</label><input type="text" value={poInfo.poNumber} onChange={(e) => setPoInfo({...poInfo, poNumber: e.target.value})} className="w-full mt-1 px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm" /></div>
                    <div><label className="text-xs text-slate-400">{t.vendor}</label><input type="text" value={poInfo.vendor} onChange={(e) => setPoInfo({...poInfo, vendor: e.target.value})} placeholder={t.vendorPlaceholder} className="w-full mt-1 px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm" /></div>
                    <div><label className="text-xs text-slate-400">{t.date}</label><input type="date" value={poInfo.date} onChange={(e) => setPoInfo({...poInfo, date: e.target.value})} className="w-full mt-1 px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm" /></div>
                  </div>
                </div>
                <div className="bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden">
                  <div className="p-3 border-b border-slate-700"><h2 className="font-semibold flex items-center gap-2"><span className="text-amber-400"><Icons.ShoppingCart /></span> {t.cart} ({cart.length})</h2></div>
                  <div className="max-h-40 overflow-y-auto scrollbar-thin">
                    {cart.length === 0 ? (
                      <div className="p-6 text-center text-slate-500">{t.emptyCart}</div>
                    ) : (
                      <div className="divide-y divide-slate-700/50">
                        {cart.map(item => {
                          const pricing = calculatePricing(item);
                          return (
                            <div key={item.codigo} className="p-2 flex items-center gap-2 hover:bg-slate-700/20">
                              <div className="flex-1 min-w-0"><p className="font-medium text-sm truncate">{item.name}</p><p className="text-xs text-slate-400">{item.qty} × {item.bottlesPerCase} = {(item.qty*item.bottlesPerCase).toLocaleString()}</p></div>
                              <p className="text-green-400 text-xs font-semibold">+{formatCurrency(item.qty * pricing.profitPerCase)}</p>
                              <button onClick={() => removeFromCart(item.codigo)} className="p-1 text-slate-500 hover:text-red-400"><Icons.Trash /></button>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                </div>
                <div className="bg-gradient-to-br from-green-500/20 to-green-600/10 rounded-xl p-4 border border-green-500/30">
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between"><span className="text-slate-300">{t.totalCases}:</span><span className="font-bold text-lg">{totals.totalCases}</span></div>
                    <div className="flex justify-between"><span className="text-slate-300">{t.totalBottles}:</span><span className={`font-bold text-lg ${containerStatus.status === 'optimal' ? 'text-green-400' : containerStatus.status === 'over' ? 'text-red-400' : ''}`}>{totals.totalBottles.toLocaleString()}</span></div>
                    <div className="flex justify-between border-t border-green-500/30 pt-2"><span className="text-slate-300">{t.ourCost}:</span><span className="font-semibold">{formatCurrency(totals.totalCost)}</span></div>
                    <div className="flex justify-between"><span className="text-slate-300">{t.revenue} ({markupPercent}%):</span><span className="font-semibold">{formatCurrency(totals.totalRevenue)}</span></div>
                    <div className="border-t border-green-500/30 pt-2 mt-2">
                      <div className="flex justify-between items-baseline"><span className="font-semibold text-lg">{t.profit}:</span><span className="text-3xl font-bold text-green-400">{formatCurrency(totals.totalProfit)}</span></div>
                      <div className="flex justify-between text-xs mt-1"><span className="text-slate-400">{t.roi}:</span><span className="text-green-400 font-bold">{totals.totalCost > 0 ? ((totals.totalProfit / totals.totalCost) * 100).toFixed(1) : 0}%</span></div>
                    </div>
                  </div>
                </div>
                <textarea value={poInfo.notes} onChange={(e) => setPoInfo({...poInfo, notes: e.target.value})} placeholder={t.orderNotes} rows={2} className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-xl text-sm resize-none" />
                <button onClick={() => setShowPO(true)} disabled={cart.length === 0} className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition ${cart.length === 0 ? 'bg-slate-700 text-slate-500' : 'bg-gradient-to-r from-green-500 to-green-600 text-white shadow-lg shadow-green-500/20'}`}>
                  <Icons.FileText /> {t.generatePO}
                </button>
              </div>
            </div>
          </div>

          {/* Mobile Bottom Bar */}
          <div className="lg:hidden fixed bottom-0 inset-x-0 bg-slate-900 border-t border-slate-700 p-2 safe-bottom z-40">
            <div className="flex items-center gap-2">
              <div className="flex-1 grid grid-cols-3 gap-1 text-center text-xs">
                <div><p className="text-slate-500">{t.totalCases}</p><p className="font-bold text-amber-400">{totals.totalCases}</p></div>
                <div><p className="text-slate-500">{t.totalBottles}</p><p className={`font-bold ${containerStatus.status === 'optimal' ? 'text-green-400' : containerStatus.status === 'over' ? 'text-red-400' : ''}`}>{totals.totalBottles.toLocaleString()}</p></div>
                <div><p className="text-green-400">{t.profit}</p><p className="font-bold text-green-400">{formatCurrency(totals.totalProfit)}</p></div>
              </div>
              <button onClick={() => setShowMobileCart(true)} className={`px-4 py-3 rounded-xl font-bold flex items-center gap-2 ${cart.length === 0 ? 'bg-slate-700 text-slate-500' : 'bg-green-500 text-white'}`}>
                <Icons.ShoppingCart />
                <span className="hidden xs:inline">{t.viewCart}</span>
                {cart.length > 0 && <span className="bg-white/20 px-2 py-0.5 rounded-full text-sm">{cart.length}</span>}
              </button>
            </div>
          </div>

          {/* Mobile Cart Panel */}
          <MobileCartPanel />
          
          {/* Overlay */}
          {showMobileCart && <div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={() => setShowMobileCart(false)} />}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
